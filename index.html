<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è¨˜å¸³å°å¹«æ‰‹ - ç™»å…¥</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    :root { --primary: #4e54c8; --bg-grad: linear-gradient(to right, #4e54c8, #8f94fb); }
    body { font-family: 'Noto Sans TC', sans-serif; height: 100vh; display: flex; justify-content: center; align-items: center; background: var(--bg-grad); margin: 0; }
    
    /* å¡ç‰‡æ¨£å¼ */
    .card { background: rgba(255,255,255,0.95); padding: 40px 30px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); width: 320px; text-align: center; transition: 0.3s; position: relative; overflow: hidden; }
    
    /* â˜…â˜…â˜… Logo å€å¡Šæ¨£å¼ â˜…â˜…â˜… */
    .app-logo {
      width: 70px; height: 70px; background: #eef2ff; border-radius: 50%; 
      margin: 0 auto 10px; display: flex; justify-content: center; align-items: center;
      font-size: 32px; color: var(--primary); box-shadow: 0 4px 10px rgba(78, 84, 200, 0.1);
    }
    .app-name { font-size: 22px; font-weight: 700; color: #333; margin-bottom: 5px; }
    .app-sub { font-size: 13px; color: #777; margin-bottom: 25px; letter-spacing: 1px; }

    /* è¼¸å…¥æ¡†èˆ‡æŒ‰éˆ• */
    h2 { color: var(--primary); margin-bottom: 20px; font-size: 18px; border-bottom: 2px solid #f0f0f0; display: inline-block; padding-bottom: 5px;}
    input { width: 100%; padding: 12px; margin: 8px 0; border: 2px solid #eee; border-radius: 25px; outline: none; box-sizing: border-box; font-family: inherit; transition: 0.3s; }
    input:focus { border-color: #8f94fb; background: #fff; }
    button { width: 100%; padding: 12px; margin-top: 15px; background: var(--primary); color: white; border: none; border-radius: 25px; cursor: pointer; font-size: 16px; font-family: inherit; transition: 0.3s; box-shadow: 0 4px 10px rgba(78, 84, 200, 0.3); }
    button:hover { background: #3c41a3; transform: translateY(-2px); box-shadow: 0 6px 15px rgba(78, 84, 200, 0.4); }
    button:disabled { background: #ccc; cursor: not-allowed; transform: none; box-shadow: none; }
    .secondary { background: transparent; color: #666; border: 1px solid #ddd; margin-top: 10px; font-size: 14px; box-shadow: none; }
    .secondary:hover { background: #f0f0f0; color: #333; transform: none; }
    .hint { font-size: 12px; color: #888; text-align: left; margin-left: 10px; }

    /* å½ˆå‡ºè¦–çª— CSS */
    .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; display: none; justify-content: center; align-items: center; backdrop-filter: blur(3px); }
    .modal-box { background: white; padding: 30px; border-radius: 15px; width: 280px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.3); animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
    @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    .icon-box { width: 60px; height: 60px; margin: 0 auto 15px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 30px; }
    .success .icon-box { background: #e3f9e5; color: #28a745; border: 2px solid #28a745; }
    .error .icon-box { background: #fdecea; color: #dc3545; border: 2px solid #dc3545; }
    .modal-title { font-weight: bold; font-size: 18px; margin-bottom: 10px; color: #333; }
    .modal-msg { font-size: 14px; color: #666; margin-bottom: 20px; line-height: 1.5; }
    .modal-btn { background: #4e54c8; color: white; padding: 10px 25px; border-radius: 20px; border: none; cursor: pointer; width: 100%; font-size: 15px; }
  </style>
</head>
<body>

  <div class="card" id="loginCard">
    <div class="app-logo">ğŸ’°</div>
    <div class="app-name">è¨˜å¸³å°å¹«æ‰‹</div>
    <div class="app-sub">è¼•é¬†ç®¡ç†æ‚¨çš„å€‹äººèˆ‡åœ˜é«”è²¡å‹™</div>
    
    <h2>å¸³è™Ÿç™»å…¥</h2>
    
    <input type="text" id="l_account" placeholder="è«‹è¼¸å…¥å¸³è™Ÿ">
    <input type="password" id="l_pass" placeholder="è«‹è¼¸å…¥å¯†ç¢¼">
    <button onclick="login()">ç™»å…¥</button>
    <button class="secondary" onclick="toggleView()">è¨»å†Šæ–°å¸³è™Ÿ</button>
  </div>

  <div class="card" id="regCard" style="display:none;">
    <div class="app-logo">ğŸ“</div>
    <div class="app-name">è¨˜å¸³å°å¹«æ‰‹</div>
    <div class="app-sub">å»ºç«‹æ‚¨çš„å°ˆå±¬å¸³æˆ¶</div>

    <h2>è¨»å†Šå¸³è™Ÿ</h2>
    <div class="hint">1. è¨­å®šé¡¯ç¤ºåç¨± (ä¾‹å¦‚: å°æ˜)</div>
    <input type="text" id="r_username" placeholder="ç”¨æˆ¶å">
    <div class="hint">2. è¨­å®šç™»å…¥å¸³è™Ÿ (éœ€å«æ•¸å­—)</div>
    <input type="text" id="r_account" placeholder="å¸³è™Ÿ">
    <div class="hint">3. è¨­å®šå¯†ç¢¼ (éœ€å«æ•¸å­—)</div>
    <input type="password" id="r_pass" placeholder="å¯†ç¢¼">
    <button onclick="register()">ç«‹å³è¨»å†Š</button>
    <button class="secondary" onclick="toggleView()">è¿”å›ç™»å…¥</button>
  </div>

  <div class="modal-overlay" id="myModal">
    <div class="modal-box" id="modalContent">
      <div class="icon-box" id="modalIcon"></div>
      <div class="modal-title" id="modalTitle"></div>
      <div class="modal-msg" id="modalMsg"></div>
      <button class="modal-btn" onclick="closeModal()">ç¢ºå®š</button>
    </div>
  </div>

<script>
  // â˜…â˜…â˜… è«‹ç¢ºèªé€™æ˜¯ä¸æ˜¯ä½ çš„ GAS ç¶²å€ â˜…â˜…â˜…
  const API_URL = "https://script.google.com/macros/s/AKfycbz8-1i4zy20ChiZm1lzafRQo18iTiHN0eYzQnj-B3dQY8AjUgMnyEsEdlwmVV516K2V/exec";

  function callAPI(payload) {
    return fetch(API_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'text/plain;charset=utf-8' },
      body: JSON.stringify(payload),
    }).then(res => res.json());
  }

  function showPopup(type, title, msg, callback) {
    var overlay = document.getElementById('myModal');
    var content = document.getElementById('modalContent');
    var icon = document.getElementById('modalIcon');
    content.className = 'modal-box ' + type; 
    icon.innerHTML = type === 'success' ? 'âœ”' : 'âœ˜';
    document.getElementById('modalTitle').innerText = title;
    document.getElementById('modalMsg').innerText = msg;
    overlay.style.display = 'flex';
    window.currentCallback = callback;
  }

  function closeModal() {
    document.getElementById('myModal').style.display = 'none';
    if(window.currentCallback) { window.currentCallback(); window.currentCallback = null; }
  }

  function toggleView() {
    var l = document.getElementById('loginCard');
    var r = document.getElementById('regCard');
    l.style.display = (l.style.display === 'none') ? 'block' : 'none';
    r.style.display = (r.style.display === 'none') ? 'block' : 'none';
  }

  function login() {
    var acc = document.getElementById('l_account').value;
    var pass = document.getElementById('l_pass').value;
    if(!acc || !pass) return showPopup('error', 'æ¬„ä½éŒ¯èª¤', 'è«‹è¼¸å…¥å¸³è™Ÿå¯†ç¢¼');

    var btn = document.querySelector('#loginCard button');
    var originalText = btn.innerText;
    btn.disabled = true; btn.innerText = "é©—è­‰ä¸­...";

    callAPI({ action: 'login', account: acc, password: pass })
    .then(res => {
      if(res.status === 'success'){
        localStorage.setItem('currentAccount', res.account);
        localStorage.setItem('currentUsername', res.username);
        showPopup('success', 'ç™»å…¥æˆåŠŸ', 'æ­¡è¿å›ä¾†ï¼Œ' + res.username + 'ï¼', function(){
           window.location.href = "main.html"; 
        });
      } else { 
        showPopup('error', 'ç™»å…¥å¤±æ•—', res.msg || 'å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤');
        btn.disabled = false; btn.innerText = originalText;
      }
    })
    .catch(error => {
      console.error(error);
      showPopup('error', 'é€£ç·šéŒ¯èª¤', 'ç„¡æ³•é€£æ¥ä¼ºæœå™¨ï¼Œè«‹ç¨å¾Œå†è©¦');
      btn.disabled = false; btn.innerText = originalText;
    });
  }

  function register() {
    var username = document.getElementById('r_username').value;
    var acc = document.getElementById('r_account').value;
    var pass = document.getElementById('r_pass').value;
    if(!username || !acc || !pass) return showPopup('error', 'æ¬„ä½éŒ¯èª¤', 'æ‰€æœ‰æ¬„ä½çš†ç‚ºå¿…å¡«');

    var btn = document.querySelector('#regCard button');
    btn.disabled = true; btn.innerText = "è¨»å†Šä¸­...";

    callAPI({ action: 'register', account: acc, password: pass, username: username })
    .then(res => {
      btn.disabled = false; btn.innerText = "ç«‹å³è¨»å†Š";
      if(res.status === 'success') {
        showPopup('success', 'è¨»å†ŠæˆåŠŸ', 'æ‚¨çš„å¸³è™Ÿå·²å»ºç«‹ï¼Œè«‹ç™»å…¥ã€‚', function(){ toggleView(); });
      } else { showPopup('error', 'è¨»å†Šå¤±æ•—', res.msg); }
    })
    .catch(error => {
      console.error(error);
      btn.disabled = false; btn.innerText = "ç«‹å³è¨»å†Š";
      showPopup('error', 'é€£ç·šéŒ¯èª¤', 'ç„¡æ³•é€£æ¥ä¼ºæœå™¨');
    });
  }
</script>
</body>
</html>
